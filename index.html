<!DOCTYPE html>
<html lang="en" data-theme="light">

<head>
  <meta charset="UTF-8" />
  <title>Millie Billie ğŸŒ</title>
  <link rel="icon" type="image/svg+xml" href="millie-billie-icon.svg">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@picocss/pico@2/css/pico.min.css">
  <style>
    td, th { white-space: nowrap; }
    details summary { cursor: pointer; }
    .flag { font-size: 1.2em; margin-right: 4px; }
    .dark-toggle { position: absolute; top: 1rem; right: 1rem; }
  </style>
</head>
<body>
  <main class="container">
    <button class="dark-toggle" onclick="toggleDarkMode()">ğŸŒ“</button>
    <h1>ğŸ’¸ Millie Billie</h1>
    <h4>Check how rich you are around the world!</h4>

    <form onsubmit="event.preventDefault(); checkNetWorth();">
      <label>
        Enter your net worth
        <input type="number" id="amount" placeholder="e.g. 1000000" required />
      </label>
      <label>
        Select your currency
        <select id="currency" required></select>
      </label>
      <button type="submit">Check</button>
    </form>

    <div id="result" style="margin-top:2rem;"></div>
  </main>

  <script>
    const currencySelect = document.getElementById('currency');
    const resultDiv = document.getElementById('result');

    const currencySymbols = {
      USD: "US Dollar", EUR: "Euro", GBP: "British Pound", JPY: "Japanese Yen", INR: "Indian Rupee",
      AUD: "Australian Dollar", CAD: "Canadian Dollar", CNY: "Chinese Yuan", BRL: "Brazilian Real",
      ZAR: "South African Rand", CHF: "Swiss Franc", SEK: "Swedish Krona", MXN: "Mexican Peso",
      RUB: "Russian Ruble", KRW: "South Korean Won", TRY: "Turkish Lira", NZD: "New Zealand Dollar",
      SGD: "Singapore Dollar", HKD: "Hong Kong Dollar", NOK: "Norwegian Krone", DKK: "Danish Krone",
      PLN: "Polish Zloty", CZK: "Czech Koruna", HUF: "Hungarian Forint", THB: "Thai Baht",
      IDR: "Indonesian Rupiah", PHP: "Philippine Peso", MYR: "Malaysian Ringgit", SAR: "Saudi Riyal",
      AED: "UAE Dirham", EGP: "Egyptian Pound", ARS: "Argentine Peso", VND: "Vietnamese Dong",
      RON: "Romanian Leu", UAH: "Ukrainian Hryvnia", CLP: "Chilean Peso", BGN: "Bulgarian Lev",
      ILS: "Israeli Shekel", PKR: "Pakistani Rupee", LKR: "Sri Lankan Rupee", NGN: "Nigerian Naira",
      KES: "Kenyan Shilling", TWD: "Taiwan Dollar", MAD: "Moroccan Dirham", BDT: "Bangladeshi Taka",
      IQD: "Iraqi Dinar"
    };

    const currencyCountries = {
      USD: { country: 'United States', flag: 'ğŸ‡ºğŸ‡¸' },
      EUR: { country: 'European Union', flag: 'ğŸ‡ªğŸ‡º' },
      GBP: { country: 'United Kingdom', flag: 'ğŸ‡¬ğŸ‡§' },
      JPY: { country: 'Japan', flag: 'ğŸ‡¯ğŸ‡µ' },
      INR: { country: 'India', flag: 'ğŸ‡®ğŸ‡³' },
      AUD: { country: 'Australia', flag: 'ğŸ‡¦ğŸ‡º' },
      CAD: { country: 'Canada', flag: 'ğŸ‡¨ğŸ‡¦' },
      CNY: { country: 'China', flag: 'ğŸ‡¨ğŸ‡³' },
      BRL: { country: 'Brazil', flag: 'ğŸ‡§ğŸ‡·' },
      ZAR: { country: 'South Africa', flag: 'ğŸ‡¿ğŸ‡¦' },
      CHF: { country: 'Switzerland', flag: 'ğŸ‡¨ğŸ‡­' },
      SEK: { country: 'Sweden', flag: 'ğŸ‡¸ğŸ‡ª' },
      MXN: { country: 'Mexico', flag: 'ğŸ‡²ğŸ‡½' },
      RUB: { country: 'Russia', flag: 'ğŸ‡·ğŸ‡º' },
      KRW: { country: 'South Korea', flag: 'ğŸ‡°ğŸ‡·' },
      TRY: { country: 'TÃ¼rkiye', flag: 'ğŸ‡¹ğŸ‡·' },
      NZD: { country: 'New Zealand', flag: 'ğŸ‡³ğŸ‡¿' },
      SGD: { country: 'Singapore', flag: 'ğŸ‡¸ğŸ‡¬' },
      HKD: { country: 'Hong Kong', flag: 'ğŸ‡­ğŸ‡°' },
      NOK: { country: 'Norway', flag: 'ğŸ‡³ğŸ‡´' },
      DKK: { country: 'Denmark', flag: 'ğŸ‡©ğŸ‡°' },
      PLN: { country: 'Poland', flag: 'ğŸ‡µğŸ‡±' },
      CZK: { country: 'Czech Republic', flag: 'ğŸ‡¨ğŸ‡¿' },
      HUF: { country: 'Hungary', flag: 'ğŸ‡­ğŸ‡º' },
      THB: { country: 'Thailand', flag: 'ğŸ‡¹ğŸ‡­' },
      IDR: { country: 'Indonesia', flag: 'ğŸ‡®ğŸ‡©' },
      PHP: { country: 'Philippines', flag: 'ğŸ‡µğŸ‡­' },
      MYR: { country: 'Malaysia', flag: 'ğŸ‡²ğŸ‡¾' },
      SAR: { country: 'Saudi Arabia', flag: 'ğŸ‡¸ğŸ‡¦' },
      AED: { country: 'UAE', flag: 'ğŸ‡¦ğŸ‡ª' },
      EGP: { country: 'Egypt', flag: 'ğŸ‡ªğŸ‡¬' },
      ARS: { country: 'Argentina', flag: 'ğŸ‡¦ğŸ‡·' },
      VND: { country: 'Vietnam', flag: 'ğŸ‡»ğŸ‡³' },
      RON: { country: 'Romania', flag: 'ğŸ‡·ğŸ‡´' },
      UAH: { country: 'Ukraine', flag: 'ğŸ‡ºğŸ‡¦' },
      CLP: { country: 'Chile', flag: 'ğŸ‡¨ğŸ‡±' },
      BGN: { country: 'Bulgaria', flag: 'ğŸ‡§ğŸ‡¬' },
      ILS: { country: 'Israel', flag: 'ğŸ‡®ğŸ‡±' },
      PKR: { country: 'Pakistan', flag: 'ğŸ‡µğŸ‡°' },
      LKR: { country: 'Sri Lanka', flag: 'ğŸ‡±ğŸ‡°' },
      NGN: { country: 'Nigeria', flag: 'ğŸ‡³ğŸ‡¬' },
      KES: { country: 'Kenya', flag: 'ğŸ‡°ğŸ‡ª' },
      TWD: { country: 'Taiwan', flag: 'ğŸ‡¹ğŸ‡¼' },
      MAD: { country: 'Morocco', flag: 'ğŸ‡²ğŸ‡¦' },
      BDT: { country: 'Bangladesh', flag: 'ğŸ‡§ğŸ‡©' },
      IQD: { country: 'Iraq', flag: 'ğŸ‡®ğŸ‡¶' }
    };

    function getFlag(code) {
      return currencyCountries[code]?.flag || '';
    }

    function formatCurrency(value, code) {
      try {
        return new Intl.NumberFormat(undefined, {
          style: 'currency',
          currency: code,
          maximumFractionDigits: 2
        }).format(value);
      } catch {
        return value.toFixed(2) + ` ${code}`;
      }
    }

    function toggleDarkMode() {
      const current = document.documentElement.getAttribute('data-theme');
      document.documentElement.setAttribute('data-theme', current === 'dark' ? 'light' : 'dark');
    }

    function loadCurrencies() {
      const params = new URLSearchParams(window.location.search);
      const selected = params.get("currency");
      const amount = params.get("amount");
      const sortedCodes = Object.keys(currencySymbols).sort();

      for (let code of sortedCodes) {
        const name = currencySymbols[code];
        const { country = '', flag = '' } = currencyCountries[code] || {};
        const option = document.createElement('option');
        option.value = code;
        option.text = `${flag} ${code} - ${name}${country ? ' (' + country + ')' : ''}`;
        if (code === selected) option.selected = true;
        currencySelect.appendChild(option);
      }

      if (amount) document.getElementById('amount').value = amount;
      if (amount && selected) checkNetWorth();
    }

    async function checkNetWorth() {
      const amount = parseFloat(document.getElementById('amount').value);
      const base = currencySelect.value;
      if (!amount || !base) return;

      try {
        const res = await fetch(`https://cdn.jsdelivr.net/npm/@fawazahmed0/currency-api@latest/v1/currencies/${base.toLowerCase()}.json`);
        const data = await res.json();
        const rates = data[base.toLowerCase()];

        const filteredRates = Object.entries(rates).filter(([code]) =>
          currencySymbols.hasOwnProperty(code.toUpperCase())
        );

        let millionaireCount = 0, billionaireCount = 0, nearest = [];

        const results = filteredRates.map(([code, rate]) => {
          const upperCode = code.toUpperCase();
          const converted = amount * rate;
          if (converted >= 1_000_000) millionaireCount++;
          if (converted >= 1_000_000_000) billionaireCount++;
          if (converted < 1_000_000) nearest.push({ code: upperCode, amount: converted });
          return { code: upperCode, converted };
        });

        const millionaireResults = results.filter(r => r.converted >= 1_000_000);
        const otherResults = results.filter(r => r.converted < 1_000_000);
        nearest.sort((a, b) => b.amount - a.amount);
        const top3 = nearest.slice(0, 3);

        const url = new URL(window.location);
        url.searchParams.set("amount", amount);
        url.searchParams.set("currency", base);
        history.replaceState(null, '', url.toString());

        resultDiv.innerHTML = `
          <h3>Results</h3>
          <p>ğŸ‰ You are a <strong>millionaire in ${millionaireCount}</strong> currencies.</p>
          <p>ğŸš€ You are a <strong>billionaire in ${billionaireCount}</strong> currencies.</p>
          ${millionaireCount === 0 ? `
            <p>ğŸ“ˆ Closest to millionaire in:</p>
            <ul>${top3.map(x => `<li>${getFlag(x.code)} ${x.code}: ${formatCurrency(x.amount, x.code)}</li>`).join('')}</ul>
          ` : ''}

          <h4>ğŸŒŸ Millionaire & Billionaire Currencies</h4>
          <table>
            <thead><tr><th>Currency</th><th>Converted</th><th>Status</th></tr></thead>
            <tbody>
              ${millionaireResults.map(r => `
                <tr>
                  <td>${getFlag(r.code)} ${r.code}</td>
                  <td>${formatCurrency(r.converted, r.code)}</td>
                  <td>${r.converted >= 1_000_000_000 ? 'ğŸ’° Billionaire' : 'âœ… Millionaire'}</td>
                </tr>
              `).join('')}
            </tbody>
          </table>

          <details>
            <summary>ğŸ“„ Show All Currencies</summary>
            <table>
              <thead><tr><th>Currency</th><th>Converted</th><th>Status</th></tr></thead>
              <tbody>
                ${results.map(r => `
                  <tr>
                    <td>${getFlag(r.code)} ${r.code}</td>
                    <td>${formatCurrency(r.converted, r.code)}</td>
                    <td>
                      ${r.converted >= 1_000_000_000 ? 'ğŸ’° Billionaire' :
                        r.converted >= 1_000_000 ? 'âœ… Millionaire' : ''}
                    </td>
                  </tr>
                `).join('')}
              </tbody>
            </table>
          </details>
        `;
      } catch (err) {
        console.error("Conversion failed:", err);
        resultDiv.innerHTML = `<p style="color:red;">Failed to fetch exchange rates. Try again later.</p>`;
      }
    }

    loadCurrencies();
  </script>
</body>

</html>
